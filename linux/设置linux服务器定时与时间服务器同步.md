在一些大公司经常出现这样一个情况：公司或一些机关单位的内部业务系统的应用服务器以及数据都是做的多机集群部署而且基本都是linux系统， 而且都是内部网，不与外网通讯的。这样经常就会出现一个情况，我发送任务的时间还晚于对方任务接收的时间。这样经常令我们头痛，那为什么会出现这样一个情 况呢，其实就是linux机器的系统没有定时同步导致的，这个问题不仅linux系统有，windows系统也会出现这样的问题，比如我们的 windows系统很久没开过机了，那么我们就会发现windows系统上的时间不对了，但是为什么我们常使用的windows系统就不会时间不一致呢， 因为我们的windows系统会自动定时的与远程标准的时间服务器同步时间，对出现的时间误差进行校准。

但是这里我们说了，是内网的linux系统，不能与外界互联网通讯而且linux因为其开放性的原因也有一个弊端，很多东西都没有设置死，只能自己去设置，尤其是黑乎乎的命令行系统。

这里教大家一个方法就是设置linux自动定时的与某一个内部时间服务器同步，这样就可以保证多台机器的时间始终一致。这里主要有两个问题：

1.如何实现与指定时间服务器同步，进行时间校准？

2.怎样实现linux系统服务级的定时执行？

好吧，下面依次解决这两个问题就好了。首先假设我们的时间服务器的ip地址为192.168.1.10。

1.时间同步我们用命令ntpdate，这个命令具体用法以后我的博客会专门讲到这个问题，也可以查看命令帮助。这里先直接使用即可：

```
 ntpdate -u 192.168.1.10 
 #这样就可以与192.168.1.10的时间服务器同步了。
 ```

2.怎样实现定时执行。这里主要都是用到/etc/crontab实现定时。这个文件是linux的系统定时调度文件，在系统启动后会加载这个文件。先看下这个文件：

```
SHELL=/bin/bash PATH=/sbin:/bin:/usr/sbin:/usr/bin MAILTO=root
HOME=/

# For details see man 4 crontabs

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  *  command to be executed

~
~
~
~
```
看看这个文件，前面四行可以忽略不管。其实这个有个例子在这里了，非常容易看懂，关键就是这一行：
```
*  *  *  *  *  command to be executed
```
第一个*表示分钟，第二个*表示小时，第三个*表示一个月的那一天，第四个*表示月份，第五个*表示一周的那一天。其中要表示任何一个都可以就直接用*表示。前面五个位置以后就表示要执行的命令和参数。
所以定时执行已经掌握了，那么我们定时时间同步校准应该怎样呢。

首先进入/etc/crontab文件 vim /etc/crontab
插入一行定时执行同步代码，假设我们每天凌晨1点执行一次时间同步。即如下代码：
```
 00 1 * * * root ntpdate -u 192.168.1.10
 ```
这样我们就设置好了linux服务器定时与时间服务器同步校准时间的任务了。bingo！是不是很简单呢

如果有时间的话，以后会写一下 ntpdate命令的使用以及时间服务器的搭建。